{% extends "base2.html" %}
{% load static %}
{% block body %}

        <!-- Modal para agregar agencia -->
        <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addModalLabel">Agregar Nuevo hotel</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form method="POST" action="{% url 'agregar_hotel' %}" enctype="multipart/form-data">
                        {% csrf_token %}
                    
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="nombre" name="nombre" required value="{{ form.nombre.value|default_if_none:'' }}">
                            {% if form.nombre.errors %}
                                <div class="alert alert-danger">{{ form.nombre.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="provincia" class="form-label">Provincia</label>
                            <input type="text" class="form-control" id="provincia" name="provincia" required value="{{ form.provincia.value|default_if_none:'' }}">
                            {% if form.provincia.errors %}
                                <div class="alert alert-danger">{{ form.provincia.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="costo" class="form-label">Costo</label>
                            <input type="number" step="0.01" class="form-control" id="costo" name="costo" required value="{{ form.costo.value|default_if_none:'' }}">
                            {% if form.costo.errors %}
                                <div class="alert alert-danger">{{ form.costo.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="habitaciones" class="form-label">Habitaciones</label>
                            <input type="number" class="form-control" id="habitaciones" name="habitaciones" required value="{{ form.habitaciones.value|default_if_none:'' }}">
                            {% if form.habitaciones.errors %}
                                <div class="alert alert-danger">{{ form.habitaciones.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="bano" class="form-label">Baño</label>
                            <input type="number" class="form-control" id="bano" name="bano" required value="{{ form.bano.value|default_if_none:'' }}">
                            {% if form.bano.errors %}
                                <div class="alert alert-danger">{{ form.bano.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="garaje" class="form-label">Garaje</label>
                            <input type="checkbox" class="form-check-input" id="garaje" name="garaje" {% if form.garaje.value %}checked{% endif %}>
                        </div>
                    
                        <div class="mb-3">
                            <label for="tamano" class="form-label">Tamaño</label>
                            <input type="text" class="form-control" id="tamano" name="tamano" required value="{{ form.tamano.value|default_if_none:'' }}">
                            {% if form.tamano.errors %}
                                <div class="alert alert-danger">{{ form.tamano.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="mensaje" class="form-label">Mensaje</label>
                            <input type="text" class="form-control" id="mensaje" name="mensaje" required value="{{ form.mensaje.value|default_if_none:'' }}">
                            {% if form.mensaje.errors %}
                                <div class="alert alert-danger">{{ form.mensaje.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="llamada" class="form-label">Llamada</label>
                            <input type="text" class="form-control" id="llamada" name="llamada" required value="{{ form.llamada.value|default_if_none:'' }}">
                            {% if form.llamada.errors %}
                                <div class="alert alert-danger">{{ form.llamada.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="ubicacion" class="form-label">Ubicación URL</label>
                            <input type="text" class="form-control" id="ubicacion" name="ubicacion" required value="{{ form.ubicacion.value|default_if_none:'' }}">
                            {% if form.ubicacion.errors %}
                                <div class="alert alert-danger">{{ form.ubicacion.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="redes" class="form-label">Redes</label>
                            <input type="text" class="form-control" id="redes" name="redes" required value="{{ form.redes.value|default_if_none:'' }}">
                            {% if form.redes.errors %}
                                <div class="alert alert-danger">{{ form.redes.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="imagen_url" class="form-label">Imagen</label>
                            <input type="file" class="form-control" id="imagen_url" name="imagen_url" accept="image/*" required>
                            {% if form.imagen_url.errors %}
                                <div class="alert alert-danger">{{ form.imagen_url.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="valoracion" class="form-label">Valoración</label>
                            <input type="number" step="0.01" class="form-control" id="valoracion" name="valoracion" required value="{{ form.valoracion.value|default_if_none:'' }}">
                            {% if form.valoracion.errors %}
                                <div class="alert alert-danger">{{ form.valoracion.errors.as_text }}</div>
                            {% endif %}
                        </div>
                    
                        <div class="mb-3">
                            <label for="es_publicidad" class="form-label">Es Publicidad</label>
                            <input type="checkbox" class="form-check-input" id="es_publicidad" name="es_publicidad" {% if form.es_publicidad.value %}checked{% endif %}>
                        </div>
                    
                        <button type="submit" class="btn btn-primary">Agregar</button>
                    </form>
                </div>
            </div>
        </div>
        
    <div class="col-md-9">
        <h4>Lista de Hoteles</h4>
        <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addModal">Registrar</button>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Provincia</th>
                    <th>Costo</th>
                    <th>HT</th>
                    <th>Baño</th>
                    <th>Garaje</th>
                    <th>Tamaño</th>
                    <th>Mensaje</th>
                    <th>Llamada</th>
                    <th>UB</th>
                    <th>Redes</th>
                    <th>Imagen</th>
                    <th>Valoración</th>
                    <th>Publicidad</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for hotel in hoteles %}
                <tr>
                    <td>{{ hotel.id }}</td>
                    <td>{{ hotel.nombre }}</td>
                    <td>{{ hotel.provincia }}</td>
                    <td>{{ hotel.costo }}</td>
                    <td>{{ hotel.habitaciones }}</td>
                    <td>{{ hotel.bano }}</td>
                    <td>{{ hotel.garaje }}</td>
                    <td>{{ hotel.tamano }}</td>
                    <td>{{ hotel.mensaje }}</td>
                    <td>{{ hotel.llamada }}</td>
                    <td>
                        <a href="{{ hotel.ubicacion_url }}" target="_blank">
                            <img src="{% static 'img/location-icon.png' %}" alt="Ubicación" style="width: 30px;">
                        </a>
                    </td>
                    <td>
                        <a href="{{ hotel.redes }}" target="_blank">
                            <img src="{% static 'img/social-media-icon.png' %}" alt="Redes Sociales" style="width: 30px;">
                        </a>
                    </td>
                    <td><img src="{{ hotel.imagen_url }}" alt="Imagen de {{ hotel.nombre }}" style="width: 100px;"></td>
                    <td>{{ hotel.valoracion }}</td>
                    <td>{{ hotel.es_publicidad|yesno:"Sí,No" }}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editModal"
                            data-id="{{ hotel.id }}"
                            data-nombre="{{ hotel.nombre }}"
                            data-provincia="{{ hotel.provincia }}"
                            data-costo="{{ hotel.costo }}"
                            data-habitaciones="{{ hotel.habitaciones }}"
                            data-bano="{{ hotel.bano }}"
                            data-garaje="{{ hotel.garaje }}"
                            data-tamano="{{ hotel.tamano }}"
                            data-mensaje="{{ hotel.mensaje }}"
                            data-llamada="{{ hotel.llamada }}"
                            data-ubicacion="{{ hotel.ubicacion }}"
                            data-redes="{{ hotel.redes }}"
                            data-imagen_url="{{ hotel.imagen_url }}"
                            data-valoracion="{{ hotel.valoracion }}"
                            data-es_publicidad="{{ hotel.es_publicidad }}">Editar</button>
                            <h2></h2>
                        <a href="{% url 'eliminar_hotel' hotel.id %}" class="btn btn-danger btn-sm">Eliminar</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="16" class="text-center">No hay hoteles disponibles</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal para editar hotel -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Editar Hotel</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{% url 'editar_hotel' 0 %}" enctype="multipart/form-data" id="editForm">
                {% csrf_token %}
                <div class="modal-body">
                    <input type="hidden" id="edit-id" name="id">
                    <div class="mb-3">
                        <label for="edit-nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="edit-nombre" name="nombre" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-provincia" class="form-label">Provincia</label>
                        <input type="text" class="form-control" id="edit-provincia" name="provincia" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-costo" class="form-label">Costo</label>
                        <input type="number" class="form-control" id="edit-costo" name="costo" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-habitaciones" class="form-label">Habitaciones</label>
                        <input type="number" class="form-control" id="edit-habitaciones" name="habitaciones" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-bano" class="form-label">Baño</label>
                        <input type="number" class="form-control" id="edit-bano" name="bano" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-garaje" class="form-label">Garaje</label>
                        <input type="checkbox" class="form-check-input" id="edit-garaje" name="garaje">
                    </div>
                    <div class="mb-3">
                        <label for="edit-tamano" class="form-label">Tamaño</label>
                        <input type="text" class="form-control" id="edit-tamano" name="tamano" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-mensaje" class="form-label">Mensaje</label>
                        <input type="text" class="form-control" id="edit-mensaje" name="mensaje" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-llamada" class="form-label">Llamada</label>
                        <input type="text" class="form-control" id="edit-llamada" name="llamada" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-ubicacion" class="form-label">Ubicación URL</label>
                        <input type="text" class="form-control" id="edit-ubicacion" name="ubicacion" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-redes" class="form-label">Redes</label>
                        <input type="text" class="form-control" id="edit-redes" name="redes" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-imagen_actual" class="form-label">Imagen Actual</label>
                        <img id="edit-imagen_actual" src="" alt="Imagen Actual" style="width: 100px; display: block; margin-bottom: 10px;">
                    </div>
                    <div class="mb-3">
                        <label for="edit-imagen_url" class="form-label">Subir Nueva Imagen</label>
                        <input type="file" class="form-control" id="edit-imagen_url" name="imagen_url" accept="image/*">
                    </div>
                    <div class="mb-3">
                        <label for="edit-valoracion" class="form-label">Valoración</label>
                        <input type="number" class="form-control" id="edit-valoracion" name="valoracion" step="0.1" min="0" max="5" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-es_publicidad" class="form-label">Publicidad</label>
                        <input type="checkbox" class="form-check-input" id="edit-es_publicidad" name="es_publicidad">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        $('#editModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var id = button.data('id');
            var nombre = button.data('nombre');
            var provincia = button.data('provincia');
            var costo = button.data('costo');
            var habitaciones = button.data('habitaciones');
            var bano = button.data('bano');
            var garaje = button.data('garaje');
            var tamano = button.data('tamano');
            var mensaje = button.data('mensaje');
            var llamada = button.data('llamada');
            var ubicacion = button.data('ubicacion');
            var redes = button.data('redes');
            var imagen_url = button.data('imagen_url');
            var valoracion = button.data('valoracion');
            var es_publicidad = button.data('es_publicidad');

            var modal = $(this);
            modal.find('#edit-id').val(id);
            modal.find('#edit-nombre').val(nombre);
            modal.find('#edit-provincia').val(provincia);
            modal.find('#edit-costo').val(costo);
            modal.find('#edit-habitaciones').val(habitaciones);
            modal.find('#edit-bano').val(bano);
            modal.find('#edit-garaje').prop('checked', garaje);
            modal.find('#edit-tamano').val(tamano);
            modal.find('#edit-mensaje').val(mensaje);
            modal.find('#edit-llamada').val(llamada);
            modal.find('#edit-ubicacion').val(ubicacion);
            modal.find('#edit-redes').val(redes);
            modal.find('#edit-imagen_actual').attr('src', imagen_url);
            modal.find('#edit-valoracion').val(valoracion);
            modal.find('#edit-es_publicidad').prop('checked', es_publicidad);

            // Actualiza la URL del formulario dinámicamente
            var formAction = "{% url 'editar_hotel' 0 %}".replace('/0/', '/' + id + '/');
            modal.find('#editForm').attr('action', formAction);
        });
    });
</script>


{% endblock %}
