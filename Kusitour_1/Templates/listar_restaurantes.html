{% extends "base2.html" %}
{% load static %}
{% block body %}
<!-- Modal para agregar agencia -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addModalLabel">Agregar Nuevo Restaurante</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{% url 'agregar_restaurante' %}" enctype="multipart/form-data">
                {% csrf_token %}
                
                <div class="mb-3">
                    <label for="nombre" class="form-label">Nombre</label>
                    <input type="text" class="form-control" id="nombre" name="nombre" required value="{{ form.nombre.value|default_if_none:'' }}">
                    {% if form.nombre.errors %}
                        <div class="alert alert-danger">{{ form.nombre.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="provincia" class="form-label">Provincia</label>
                    <input type="text" class="form-control" id="provincia" name="provincia" required value="{{ form.provincia.value|default_if_none:'' }}">
                    {% if form.provincia.errors %}
                        <div class="alert alert-danger">{{ form.provincia.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="dias" class="form-label">Días</label>
                    <input type="text" class="form-control" id="dias" name="dias" required value="{{ form.dias.value|default_if_none:'' }}">
                    {% if form.dias.errors %}
                        <div class="alert alert-danger">{{ form.dias.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="horario" class="form-label">Horario</label>
                    <input type="text" class="form-control" id="horario" name="horario" required value="{{ form.horario.value|default_if_none:'' }}">
                    {% if form.horario.errors %}
                        <div class="alert alert-danger">{{ form.horario.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="sms" class="form-label">SMS</label>
                    <input type="text" class="form-control" id="sms" name="sms" required value="{{ form.sms.value|default_if_none:'' }}">
                    {% if form.sms.errors %}
                        <div class="alert alert-danger">{{ form.sms.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="llamada" class="form-label">Llamada</label>
                    <input type="text" class="form-control" id="llamada" name="llamada" required value="{{ form.llamada.value|default_if_none:'' }}">
                    {% if form.llamada.errors %}
                        <div class="alert alert-danger">{{ form.llamada.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="ubicacion" class="form-label">Ubicación URL</label>
                    <input type="text" class="form-control" id="ubicacion" name="ubicacion" required value="{{ form.ubicacion.value|default_if_none:'' }}">
                    {% if form.ubicacion.errors %}
                        <div class="alert alert-danger">{{ form.ubicacion.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="redes" class="form-label">Redes</label>
                    <input type="text" class="form-control" id="redes" name="redes" required value="{{ form.redes.value|default_if_none:'' }}">
                    {% if form.redes.errors %}
                        <div class="alert alert-danger">{{ form.redes.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="imagen_url" class="form-label">Imagen</label>
                    <input type="file" class="form-control" id="imagen_url" name="imagen_url" accept="image/*" required>
                    {% if form.imagen_url.errors %}
                        <div class="alert alert-danger">{{ form.imagen_url.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="valoracion" class="form-label">Valoración</label>
                    <input type="number" class="form-control" id="valoracion" name="valoracion" step="0.1" min="0" max="5" required value="{{ form.valoracion.value|default_if_none:'' }}">
                    {% if form.valoracion.errors %}
                        <div class="alert alert-danger">{{ form.valoracion.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="es_publicidad" class="form-label">Publicidad</label>
                    <input type="checkbox" class="form-check-input" id="es_publicidad" name="es_publicidad" {% if form.es_publicidad.value %}checked{% endif %}>
                </div>
                
                <button type="submit" class="btn btn-primary">Agregar</button>
            </form>
        </div>
    </div>
</div>


    <div class="col-md-8">
        <h4>Lista de Restaurantes</h4>
        <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addModal">Registrar</button>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Provincia</th>
                    <th>Días</th>
                    <th>Horario</th>
                    <th>SMS</th>
                    <th>Llamada</th>
                    <th>Ubicación</th>
                    <th>Redes</th>
                    <th>Imagen</th>
                    <th>Valoración</th>
                    <th>Publicidad</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for restaurante in restaurantes %}
                <tr>
                    <td>{{ restaurante.id }}</td>
                    <td>{{ restaurante.nombre }}</td>
                    <td>{{ restaurante.provincia }}</td>
                    <td>{{ restaurante.dias }}</td>
                    <td>{{ restaurante.horario }}</td>
                    <td>{{ restaurante.sms }}</td>
                    <td>{{ restaurante.llamada }}</td>
                    <td>
                        <a href="{{ restaurante.ubicacion}}" target="_blank">
                            <img src="{% static 'img/location-icon.png' %}" alt="Ubicación" style="width: 30px;">
                        </a>
                    </td>
                    <td>
                        <a href="{{ restaurante.redes }}" target="_blank">
                            <img src="{% static 'img/social-media-icon.png' %}" alt="Redes Sociales" style="width: 30px;">
                        </a>
                    </td>
                    <td><img src="{{ restaurante.imagen_url }}" alt="Imagen de {{ restaurante.nombre }}" style="width: 100px;"></td>
                    <td>{{ restaurante.valoracion }}</td>
                    <td>{{ restaurante.es_publicidad|yesno:"Sí,No"}}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editModal"
                            data-id="{{ restaurante.id }}"
                            data-nombre="{{ restaurante.nombre }}"
                            data-provincia="{{ restaurante.provincia }}"
                            data-dias="{{ restaurante.dias }}"
                            data-horario="{{ restaurante.horario }}"
                            data-sms="{{ restaurante.sms }}"
                            data-llamada="{{ restaurante.llamada }}"
                            data-ubicacion="{{ restaurante.ubicacion }}"
                            data-redes="{{ restaurante.redes }}"
                            data-imagen_url="{{ restaurante.imagen_url }}"
                            data-valoracion="{{ restaurante.valoracion }}"
                            data-es_publicidad="{{ restaurante.es_publicidad }}">Editar</button>
                            <h2></h2>
                        <a href="{% url 'eliminar_restaurante' restaurante.id %}" class="btn btn-danger btn-sm">Eliminar</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="13" class="text-center">No hay restaurantes disponibles</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal para editar restaurante -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Editar Restaurante</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{% url 'editar_restaurante' 0 %}" enctype="multipart/form-data" id="editForm">
                {% csrf_token %}
                <div class="modal-body">
                    <input type="hidden" id="edit-id" name="id">
                    <div class="mb-3">
                        <label for="edit-nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="edit-nombre" name="nombre" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-provincia" class="form-label">Provincia</label>
                        <input type="text" class="form-control" id="edit-provincia" name="provincia" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-dias" class="form-label">Días</label>
                        <input type="text" class="form-control" id="edit-dias" name="dias" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-horario" class="form-label">Horario</label>
                        <input type="text" class="form-control" id="edit-horario" name="horario" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-sms" class="form-label">SMS</label>
                        <input type="text" class="form-control" id="edit-sms" name="sms" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-llamada" class="form-label">Llamada</label>
                        <input type="text" class="form-control" id="edit-llamada" name="llamada" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-ubicacion" class="form-label">Ubicación URL</label>
                        <input type="text" class="form-control" id="edit-ubicacion" name="ubicacion" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-redes" class="form-label">Redes</label>
                        <input type="text" class="form-control" id="edit-redes" name="redes" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-imagen_actual" class="form-label">Imagen Actual</label>
                        <img id="edit-imagen_actual" src="" alt="Imagen Actual" style="width: 100px; display: block; margin-bottom: 10px;">
                    </div>
                    <div class="mb-3">
                        <label for="edit-imagen_url" class="form-label">Subir Nueva Imagen</label>
                        <input type="file" class="form-control" id="edit-imagen_url" name="imagen_url" accept="image/*">
                    </div>
                    <div class="mb-3">
                        <label for="edit-valoracion" class="form-label">Valoración</label>
                        <input type="number" class="form-control" id="edit-valoracion" name="valoracion" step="0.1" min="0" max="5" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-es_publicidad" class="form-label">Publicidad</label>
                        <input type="checkbox" class="form-check-input" id="edit-es_publicidad" name="es_publicidad">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        $('#editModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var id = button.data('id');
            var nombre = button.data('nombre');
            var provincia = button.data('provincia');
            var dias = button.data('dias');
            var horario = button.data('horario');
            var sms = button.data('sms');
            var llamada = button.data('llamada');
            var ubicacion = button.data('ubicacion');
            var redes = button.data('redes');
            var imagen_url = button.data('imagen_url');
            var valoracion = button.data('valoracion');
            var es_publicidad = button.data('es_publicidad');

            var modal = $(this);
            modal.find('#edit-id').val(id);
            modal.find('#edit-nombre').val(nombre);
            modal.find('#edit-provincia').val(provincia);
            modal.find('#edit-dias').val(dias);
            modal.find('#edit-horario').val(horario);
            modal.find('#edit-sms').val(sms);
            modal.find('#edit-llamada').val(llamada);
            modal.find('#edit-ubicacion').val(ubicacion);
            modal.find('#edit-redes').val(redes);
            modal.find('#edit-imagen_actual').attr('src', imagen_url);
            modal.find('#edit-valoracion').val(valoracion);
            modal.find('#edit-es_publicidad').prop('checked', es_publicidad);

            // Actualiza la URL del formulario dinámicamente
            var formAction = "{% url 'editar_restaurante' 0 %}".replace('/0/', '/' + id + '/');
            modal.find('#editForm').attr('action', formAction);
        });
    });
</script>

{% endblock %}
