{% extends "base2.html" %}
{% load static %}
{% block body %}
<!-- Modal para agregar agencia -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addModalLabel">Agregar Nueva Celebraciones</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{% url 'agregar_celebracion' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="nombre" class="form-label">Nombre</label>
                    <input type="text" class="form-control" id="nombre" name="nombre" required value="{{ form.nombre.value|default_if_none:'' }}">
                    {% if form.nombre.errors %}
                        <div class="alert alert-danger">{{ form.nombre.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="provincia" class="form-label">Provincia</label>
                    <input type="text" class="form-control" id="provincia" name="provincia" required value="{{ form.provincia.value|default_if_none:'' }}">
                    {% if form.provincia.errors %}
                        <div class="alert alert-danger">{{ form.provincia.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="descripcion" class="form-label">Descripción</label>
                    <input type="text" class="form-control" id="descripcion" name="descripcion" required value="{{ form.descripcion.value|default_if_none:'' }}">
                    {% if form.descripcion.errors %}
                        <div class="alert alert-danger">{{ form.descripcion.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="horario" class="form-label">Horario</label>
                    <input type="text" class="form-control" id="horario" name="horario" required value="{{ form.horario.value|default_if_none:'' }}">
                    {% if form.horario.errors %}
                        <div class="alert alert-danger">{{ form.horario.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="fechas" class="form-label">Fechas</label>
                    <input type="text" class="form-control" id="fechas" name="fechas" required value="{{ form.fechas.value|default_if_none:'' }}">
                    {% if form.fechas.errors %}
                        <div class="alert alert-danger">{{ form.fechas.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="ubicacion" class="form-label">Ubicación</label>
                    <input type="text" class="form-control" id="ubicacion" name="ubicacion" required value="{{ form.ubicacion.value|default_if_none:'' }}">
                    {% if form.ubicacion.errors %}
                        <div class="alert alert-danger">{{ form.ubicacion.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="imagen_url" class="form-label">Imagen</label>
                    <input type="file" class="form-control" id="imagen_url" name="imagen_url" accept="image/*" required>
                    {% if form.imagen_url.errors %}
                        <div class="alert alert-danger">{{ form.imagen_url.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="valoracion" class="form-label">Valoración</label>
                    <input type="number" step="0.1" min="0" max="5" class="form-control" id="valoracion" name="valoracion" required value="{{ form.valoracion.value|default_if_none:'' }}">
                    {% if form.valoracion.errors %}
                        <div class="alert alert-danger">{{ form.valoracion.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="es_publicidad" class="form-label">Publicidad</label>
                    
                    <input type="checkbox" class="form-check-input" id="es_publicidad" name="es_publicidad" {% if form.es_publicidad.value %}checked{% endif %}>
                </div>
                <button type="submit" class="btn btn-primary">Agregar</button>
            </form>
        </div>
    </div>
</div>
    <div class="col-md-8">
        <h4>Lista de Celebraciones</h4>
        <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addModal">Registrar</button>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Provincia</th>
                    <th>Descripción</th>
                    <th>Horario</th>
                    <th>Fecha</th>
                    <th>Ubicación</th>
                    <th>Imagen</th>
                    <th>Valoración</th>
                    
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for celebracion in celebraciones %}
                <tr>
                    <td>{{ celebracion.id }}</td>
                    <td>{{ celebracion.nombre }}</td>
                    <td>{{ celebracion.provincia }}</td>
                    <td>{{ celebracion.descripcion }}</td>
                    <td>{{ celebracion.horario }}</td>
                    <td>{{ celebracion.fecha }}</td>
                    <td>
                        <a href="{{ celebracion.ubicacion }}" target="_blank">
                            <img src="{% static 'img/location-icon.png' %}" alt="Ubicación" style="width: 30px;">
                        </a>
                    </td>
                    <td><img src="{{ celebracion.imagen_url }}" alt="Imagen de {{ celebracion.nombre }}" style="width: 100px;"></td>
                    <td>{{ celebracion.valoracion}}</td>
                    
                    <td>
                        <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editModal"
                        data-id="{{ celebracion.id }}"
                        data-nombre="{{ celebracion.nombre }}"
                        data-provincia="{{ celebracion.provincia }}"
                        data-descripcion="{{ celebracion.descripcion }}"
                        data-horario="{{ celebracion.horario }}"
                        data-fechas="{{ celebracion.fechas }}"
                        data-ubicacion="{{ celebracion.ubicacion }}"
                        data-imagen_url="{{ celebracion.imagen_url }}"
                        data-valoracion="{{ celebracion.valoracion }}"
                        data-es_publicidad="{{ celebracion.es_publicidad }}">Editar</button><br>
                        <h2></h2>
                        <a href="{% url 'eliminar_celebracion' celebracion.id %}" class="btn btn-danger btn-sm">Eliminar</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="11" class="text-center">No hay celebraciones disponibles</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<!-- Modal para editar celebración -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Editar Celebración</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{% url 'editar_celebracion' 0 %}" enctype="multipart/form-data" id="editForm">
                {% csrf_token %}
                <div class="modal-body">
                    <input type="hidden" id="edit-id" name="id">
                    <div class="mb-3">
                        <label for="edit-nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="edit-nombre" name="nombre" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-provincia" class="form-label">Provincia</label>
                        <input type="text" class="form-control" id="edit-provincia" name="provincia" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-descripcion" class="form-label">Descripción</label>
                        <input type="text" class="form-control" id="edit-descripcion" name="descripcion" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-horario" class="form-label">Horario</label>
                        <input type="text" class="form-control" id="edit-horario" name="horario" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-fechas" class="form-label">Fechas</label>
                        <input type="text" class="form-control" id="edit-fechas" name="fechas" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-ubicacion" class="form-label">Ubicación</label>
                        <input type="text" class="form-control" id="edit-ubicacion" name="ubicacion" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-imagen_actual" class="form-label">Imagen Actual</label>
                        <img id="edit-imagen_actual" src="" alt="Imagen Actual" style="width: 100px; display: block; margin-bottom: 10px;">
                    </div>
                    <div class="mb-3">
                        <label for="edit-imagen_url" class="form-label">Subir Nueva Imagen</label>
                        <input type="file" class="form-control" id="edit-imagen_url" name="imagen_url" accept="image/*">
                    </div>
                    <div class="mb-3">
                        <label for="edit-valoracion" class="form-label">Valoración</label>
                        <input type="number" step="0.1" min="0" max="5" class="form-control" id="edit-valoracion" name="valoracion" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-es_publicidad" class="form-label">Es Publicidad</label>
                        <input type="checkbox" class="form-check-input" id="edit-es_publicidad" name="es_publicidad">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        $('#editModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var id = button.data('id');
            var nombre = button.data('nombre');
            var provincia = button.data('provincia');
            var descripcion = button.data('descripcion');
            var horario = button.data('horario');
            var fechas = button.data('fechas');
            var ubicacion = button.data('ubicacion');
            var imagen_url = button.data('imagen_url');
            var valoracion = button.data('valoracion');
            var es_publicidad = button.data('es_publicidad');

            var modal = $(this);
            modal.find('#edit-id').val(id);
            modal.find('#edit-nombre').val(nombre);
            modal.find('#edit-provincia').val(provincia);
            modal.find('#edit-descripcion').val(descripcion);
            modal.find('#edit-horario').val(horario);
            modal.find('#edit-fechas').val(fechas);
            modal.find('#edit-ubicacion').val(ubicacion);
            modal.find('#edit-imagen_actual').attr('src', imagen_url);
            modal.find('#edit-valoracion').val(valoracion);
            modal.find('#edit-es_publicidad').prop('checked', es_publicidad);

            // Actualiza la URL del formulario dinámicamente
            var formAction = "{% url 'editar_celebracion' 0 %}".replace('/0/', '/' + id + '/');
            modal.find('#editForm').attr('action', formAction);
        });
    });
    
</script>

{% endblock %}
