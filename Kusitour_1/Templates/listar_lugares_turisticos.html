{% extends "base2.html" %}
{% load static %}
{% block body %}
<div class="row">
    <div class="col-md-4">
        <h4>Agregar Lugar Turístico</h4>
        <form method="POST" action="{% url 'agregar_lugar_turistico' %}" enctype="multipart/form-data">
            {% csrf_token %}
        
            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="nombre" name="nombre" required value="{{ form.nombre.value|default_if_none:'' }}">
                {% if form.nombre.errors %}
                    <div class="alert alert-danger">{{ form.nombre.errors.as_text }}</div>
                {% endif %}
            </div>
        
            <div class="mb-3">
                <label for="provincia" class="form-label">Provincia</label>
                <input type="text" class="form-control" id="provincia" name="provincia" required value="{{ form.provincia.value|default_if_none:'' }}">
                {% if form.provincia.errors %}
                    <div class="alert alert-danger">{{ form.provincia.errors.as_text }}</div>
                {% endif %}
            </div>
        
            <div class="mb-3">
                <label for="descripcion" class="form-label">Descripción</label>
                <input type="text" class="form-control" id="descripcion" name="descripcion" required value="{{ form.descripcion.value|default_if_none:'' }}">
                {% if form.descripcion.errors %}
                    <div class="alert alert-danger">{{ form.descripcion.errors.as_text }}</div>
                {% endif %}
            </div>
        
            <div class="mb-3">
                <label for="horario" class="form-label">Horario</label>
                <input type="text" class="form-control" id="horario" name="horario" required value="{{ form.horario.value|default_if_none:'' }}">
                {% if form.horario.errors %}
                    <div class="alert alert-danger">{{ form.horario.errors.as_text }}</div>
                {% endif %}
            </div>
        
            <div class="mb-3">
                <label for="fecha_fundacion" class="form-label">Fecha de Fundación</label>
                <input type="text" class="form-control" id="fecha_fundacion" name="fecha_fundacion" required value="{{ form.fecha_fundacion.value|default_if_none:'' }}">
                {% if form.fecha_fundacion.errors %}
                    <div class="alert alert-danger">{{ form.fecha_fundacion.errors.as_text }}</div>
                {% endif %}
            </div>
        
            <div class="mb-3">
                <label for="ubicacion" class="form-label">Ubicación URL</label>
                <input type="text" class="form-control" id="ubicacion" name="ubicacion" required value="{{ form.ubicacion.value|default_if_none:'' }}">
                {% if form.ubicacion.errors %}
                    <div class="alert alert-danger">{{ form.ubicacion.errors.as_text }}</div>
                {% endif %}
            </div>
        
            <div class="mb-3">
                <label for="imagen_url" class="form-label">Imagen</label>
                <input type="file" class="form-control" id="imagen_url" name="imagen_url" accept="image/*" required>
                {% if form.imagen_url.errors %}
                    <div class="alert alert-danger">{{ form.imagen_url.errors.as_text }}</div>
                {% endif %}
            </div>
        
            <div class="mb-3">
                <label for="valoracion" class="form-label">Valoración</label>
                <input type="number" step="0.01" class="form-control" id="valoracion" name="valoracion" required value="{{ form.valoracion.value|default_if_none:'' }}">
                {% if form.valoracion.errors %}
                    <div class="alert alert-danger">{{ form.valoracion.errors.as_text }}</div>
                {% endif %}
            </div>
        
            <div class="mb-3">
                <label for="es_publicidad" class="form-label">Es Publicidad</label>
                <input type="checkbox" class="form-check-input" id="es_publicidad" name="es_publicidad" {% if form.es_publicidad.value %}checked{% endif %}>
            </div>
        
            <button type="submit" class="btn btn-primary">Agregar</button>
        </form>
        
    </div>
    <div class="col-md-8">
        <h4>Lista de Lugares Turísticos</h4>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Provincia</th>
                    <th>Descripción</th>
                    <th>Horario</th>
                    <th>Fecha de Fundación</th>
                    <th>Ubicación</th>
                    <th>Imagen</th>
                    <th>Valoración</th>
                    
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for lugar in lugares %}
                <tr>
                    <td>{{ lugar.id }}</td>
                    <td>{{ lugar.nombre }}</td>
                    <td>{{ lugar.provincia }}</td>
                    <td>{{ lugar.descripcion }}</td>
                    <td>{{ lugar.horario }}</td>
                    <td>{{ lugar.fecha_fundacion }}</td>
                    <td>
                        <a href="{{ lugar.ubicacion_url }}" target="_blank">
                            <img src="{% static 'img/location-icon.png' %}" alt="Ubicación" style="width: 30px;">
                        </a>
                    </td>
                    <td><img src="{{ lugar.imagen_url }}" alt="Imagen de {{ lugar.nombre }}" style="width: 100px;"></td>
                    <td>{{ lugar.valoracion }}</td>
                    
                    <td>
                        <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editModal"
                            data-id="{{ lugar.id }}"
                            data-nombre="{{ lugar.nombre }}"
                            data-provincia="{{ lugar.provincia }}"
                            data-descripcion="{{ lugar.descripcion }}"
                            data-horario="{{ lugar.horario }}"
                            data-fecha_fundacion="{{ lugar.fecha_fundacion }}"
                            data-ubicacion="{{ lugar.ubicacion }}"
                            data-imagen_url="{{ lugar.imagen_url }}"
                            data-valoracion="{{ lugar.valoracion }}"
                            data-es_publicidad="{{ lugar.es_publicidad }}">Editar</button>
                            <h2></h2>
                        <a href="{% url 'eliminar_lugar_turistico' lugar.id %}" class="btn btn-danger btn-sm">Eliminar</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="11" class="text-center">No hay lugares turísticos disponibles</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal para editar lugar turístico -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Editar Lugar Turístico</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{% url 'editar_lugar_turistico' 0 %}" enctype="multipart/form-data" id="editForm">
                {% csrf_token %}
                <div class="modal-body">
                    <input type="hidden" id="edit-id" name="id">
                    <div class="mb-3">
                        <label for="edit-nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="edit-nombre" name="nombre" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-provincia" class="form-label">Provincia</label>
                        <input type="text" class="form-control" id="edit-provincia" name="provincia" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-descripcion" class="form-label">Descripción</label>
                        <input type="text" class="form-control" id="edit-descripcion" name="descripcion" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-horario" class="form-label">Horario</label>
                        <input type="text" class="form-control" id="edit-horario" name="horario" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-fecha_fundacion" class="form-label">Fecha de Fundación</label>
                        <input type="text" class="form-control" id="edit-fecha_fundacion" name="fecha_fundacion" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-ubicacion" class="form-label">Ubicación URL</label>
                        <input type="text" class="form-control" id="edit-ubicacion" name="ubicacion" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-imagen_actual" class="form-label">Imagen Actual</label>
                        <img id="edit-imagen_actual" src="" alt="Imagen Actual" style="width: 100px; display: block; margin-bottom: 10px;">
                    </div>
                    <div class="mb-3">
                        <label for="edit-imagen_url" class="form-label">Subir Nueva Imagen</label>
                        <input type="file" class="form-control" id="edit-imagen_url" name="imagen_url" accept="image/*">
                    </div>
                    <div class="mb-3">
                        <label for="edit-valoracion" class="form-label">Valoración</label>
                        <input type="number" step="0.01" class="form-control" id="edit-valoracion" name="valoracion" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-es_publicidad" class="form-label">Es Publicidad</label>
                        <input type="checkbox" class="form-check-input" id="edit-es_publicidad" name="es_publicidad">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
    $('#editModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var id = button.data('id');
        var nombre = button.data('nombre');
        var provincia = button.data('provincia');
        var descripcion = button.data('descripcion');
        var horario = button.data('horario');
        var fecha_fundacion = button.data('fecha_fundacion');
        var ubicacion = button.data('ubicacion');
        var imagen_url = button.data('imagen_url');
        var valoracion = button.data('valoracion');
        var es_publicidad = button.data('es_publicidad');

        var modal = $(this);
        modal.find('#edit-id').val(id);
        modal.find('#edit-nombre').val(nombre);
        modal.find('#edit-provincia').val(provincia);
        modal.find('#edit-descripcion').val(descripcion);
        modal.find('#edit-horario').val(horario);
        modal.find('#edit-fecha_fundacion').val(fecha_fundacion);
        modal.find('#edit-ubicacion').val(ubicacion);
        modal.find('#edit-imagen_actual').attr('src', imagen_url);
        modal.find('#edit-valoracion').val(valoracion);
        modal.find('#edit-es_publicidad').prop('checked', es_publicidad);

        // Actualiza la URL del formulario dinámicamente
        var formAction = "{% url 'editar_lugar_turistico' 0 %}".replace('/0/', '/' + id + '/');
        modal.find('#editForm').attr('action', formAction);
    });
});

</script>

{% endblock %}
